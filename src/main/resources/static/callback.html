<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="node_modules/jwt-client/jwt-client.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {

            $('#ajaxBtn').click(function(){

                $.get('https://localhost:8444/user/parker', {name:'Steve'}, function (data, textStatus, jqXHR) {
                    $('p').append(data.firstName);
                });
            });
            $('#ajaxJwtBtn').click(function(){
                var url = 'https://localhost:8444/user/parker';
                var idToken = sessionStorage.getItem('id_token');
                var headers = { Authorization: 'Bearer ' + idToken };

                $.ajax({
                    url: url,
                    headers: headers
                })
                    .done(function(result) {
                        $('p').append(result.firstName);
                    })
                    .fail(function(err) {
                        $('p').append("call failed");
                    });
            });
        });


        function callAPI(endpoint, secured) {
            var url = apiUrl + endpoint;
            var accessToken = localStorage.getItem('access_token');

            var headers;
            if (secured && accessToken) {
                headers = { Authorization: 'Bearer ' + accessToken };
            }

            $.ajax({
                url: url,
                headers: headers
            })
                .done(function(result) {
                    $('#ping-view h2').text(result.message);
                })
                .fail(function(err) {
                    $('#ping-view h2').text('Request failed: ' + err.statusText);
                });
        }
    </script>

</head>
<body>

<script src="js/parseParms.js"></script>



<div id="mainContent">
    <h1>Authentication Info</h1>

    <div id="issuer"></div>
    <div id="audience"></div>
    <div id="user"></div>
    <div id="token"></div>

</div>
<script type="application/javascript">
  //  var accessToken = getAccessToken();
    var idToken = getIdToken();
    console.log("valiating id token " + idToken);
  if (JWT.validate(idToken)) {
      console.log("id token valid");
      // If so, save it for further use
      // (by default inside localStorage)
      JWT.keep(idToken);
      // You can access the parsed version of the token anytime
      var session = JWT.remember();
      console.log("JWT INFO");
      console.log(session);

// And access any useful info inside the claim
      //var userId = session.claim.userId;

  } else {
      // If not, we might want to remove
      // the last token. Or not. Depends on you...
      JWT.forget();
  }


    sessionStorage.setItem("id_token", idToken);
    var session = JWT.remember();

    document.getElementById("issuer").appendChild(document.createTextNode("issued_by: " + session.claim.iss));

  document.getElementById("audience").appendChild(document.createTextNode("audience: " + session.claim.aud));
  document.getElementById("user").appendChild(document.createTextNode("user: " + session.claim.sub));
  document.getElementById("token").appendChild(document.createTextNode("Raw JWT: " + idToken));
</script>

<input type="button" id="ajaxBtn" value="Send GET request" /></div>
<input type="button" id="ajaxJwtBtn" value="Send GET request with JWT" /></div>

<p>
</p>
</body>

</html>